<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalii Produs</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Culori Moderne */
            --primary-gradient: linear-gradient(135deg, #4361ee 0%, #3f37c9 100%);
            --bg-body: #f4f7fe;
            --bg-card: #ffffff;
            --text-dark: #2b2d42;
            --text-muted: #8d99ae;
            --danger-color: #ef233c;
            --border-radius: 24px;
            --shadow-lg: 0 20px 50px rgba(67, 97, 238, 0.12);
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-body); 
            color: var(--text-dark);
            margin: 0; padding: 20px;
            min-height: 100vh;
            display: flex; justify-content: center; align-items: center;
            background-image: radial-gradient(at 0% 0%, rgba(67, 97, 238, 0.05) 0px, transparent 50%), 
                              radial-gradient(at 100% 100%, rgba(42, 157, 143, 0.05) 0px, transparent 50%);
        }

        /* Container Principal */
        .detail-card { 
            background: var(--bg-card); 
            border-radius: var(--border-radius); 
            box-shadow: var(--shadow-lg); 
            width: 100%; max-width: 950px;
            display: flex; flex-direction: column;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.8);
            position: relative;
        }

        @media(min-width: 800px) {
            .detail-card { flex-direction: row; min-height: 500px; }
        }

        /* Partea Stanga (Vizual) */
        .product-visual {
            background: linear-gradient(to bottom right, #f8f9fa, #eef2ff);
            flex: 1;
            display: flex; align-items: center; justify-content: center;
            min-height: 300px;
            position: relative;
            border-right: 1px solid #f0f0f0;
        }
        
        .product-icon {
            font-size: 10rem;
            filter: drop-shadow(0 15px 30px rgba(0,0,0,0.1));
            transition: transform 0.4s ease;
            cursor: default;
        }
        .detail-card:hover .product-icon { transform: scale(1.1) rotate(-5deg); }

        /* Partea Dreapta (Info) */
        .product-info {
            flex: 1.3;
            padding: 50px;
            display: flex; flex-direction: column; justify-content: center;
        }

        h1 { 
            margin: 0 0 15px 0; 
            color: var(--text-dark); 
            font-size: 2.2rem; font-weight: 800; letter-spacing: -1px;
            line-height: 1.1;
        }

        /* Grid Specificatii */
        .specs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .spec-item {
            background: #f8faff;
            padding: 12px 18px;
            border-radius: 12px;
            border: 1px solid #eef2ff;
        }

        .spec-label { font-size: 0.7rem; color: #8d99ae; text-transform: uppercase; letter-spacing: 1px; font-weight: 700; margin-bottom: 5px; display: block;}
        .spec-value { font-size: 1rem; color: var(--text-dark); font-weight: 600; }

        /* Pret si Stoc */
        .price-section {
            display: flex; justify-content: space-between; align-items: flex-end;
            margin-bottom: 40px; border-bottom: 2px solid #f8f9fa; padding-bottom: 20px;
        }

        .price-tag { 
            font-size: 2.5rem; color: var(--text-dark); font-weight: 800; 
            display: flex; align-items: baseline; gap: 5px;
        }
        .price-tag small { font-size: 0.5em; color: var(--text-muted); font-weight: 500; }

        .stock-badge {
            background: #e0f2fe; color: #0284c7;
            padding: 8px 16px; border-radius: 30px;
            font-weight: 700; font-size: 0.9rem;
        }
        
        .stock-badge.out { background: #fee2e2; color: #ef4444; }

        /* Actiuni */
        .action-area { display: flex; gap: 15px; align-items: center; }

        input[type="number"] { 
            padding: 15px; width: 70px; 
            border: 2px solid #e1e8f5; border-radius: 14px; 
            font-size: 1.2rem; text-align: center; font-weight: 700; color: var(--text-dark);
            outline: none; transition: 0.2s;
        }
        input[type="number"]:focus { border-color: #4361ee; box-shadow: 0 0 0 4px rgba(67, 97, 238, 0.1); }

        button { font-family: 'Inter', sans-serif; cursor: pointer; transition: all 0.2s; }

        button.cart-btn { 
            flex: 1; 
            background: var(--primary-gradient); 
            color: white; border: none; 
            padding: 18px; border-radius: 14px; 
            font-size: 1.1rem; font-weight: 700; 
            box-shadow: 0 10px 25px -5px rgba(67, 97, 238, 0.4);
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        button.cart-btn:hover { transform: translateY(-3px); box-shadow: 0 15px 30px -5px rgba(67, 97, 238, 0.5); }
        button.cart-btn:active { transform: scale(0.98); }
        
        button.cart-btn:disabled { 
            background: #e2e8f0; color: #94a3b8; 
            box-shadow: none; cursor: not-allowed; transform: none; 
        }

        button.back-btn { 
            background: white; 
            border: 2px solid #e2e8f0; color: #64748b; 
            padding: 16px 24px; border-radius: 14px; 
            font-weight: 600; font-size: 1rem;
        }
        button.back-btn:hover { border-color: #cbd5e1; color: var(--text-dark); background: #f8fafc; }

        #loading {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: white; z-index: 20;
            display: flex; align-items: center; justify-content: center;
            font-weight: 600; color: #4361ee; font-size: 1.2rem;
        }
    </style>
</head>
<body>

    <div class="detail-card">
        <div id="loading">Se √ÆncarcƒÉ detaliile produsului...</div>
        
        <div class="product-visual">
            <div class="product-icon">üì¶</div>
        </div>

        <div class="product-info" id="content" style="display:none; width: 100%;">
            <h1 id="d_nume">Nume Produs</h1>
            
            <div class="price-section">
                <div class="price-tag" id="d_pret">0.00 <small>RON</small></div>
                <div class="stock-badge" id="stockBadge">
                    Stoc: <span id="d_stoc">...</span>
                </div>
            </div>

            <div class="specs-grid">
                <div class="spec-item">
                    <span class="spec-label">ProducƒÉtor</span>
                    <span class="spec-value" id="d_prod">...</span>
                </div>
                <div class="spec-item">
                    <span class="spec-label">Origine</span>
                    <span class="spec-value" id="d_tara">...</span>
                </div>
                
                <div class="spec-item">
                    <span class="spec-label">Data Producere</span>
                    <span class="spec-value" id="d_data_prod">...</span>
                </div>
            </div>
            
            <div class="action-area">
                <button class="back-btn" onclick="window.history.back()">‚Üê √énapoi</button>
                <input type="number" id="cantitate" value="1" min="1">
                <button id="btnAdauga" class="cart-btn" onclick="adaugaInCos()">
                    üõí AdaugƒÉ √Æn Co»ô
                </button>
            </div>
        </div>
    </div>

    <script>
        const API = "http://localhost:8080/api";
        const urlParams = new URLSearchParams(window.location.search);
        const furnizareId = urlParams.get('id');
        const clientId = localStorage.getItem('clientId');
        let currentOffer = null;

        if(!clientId) {
            alert("Trebuie sƒÉ fii logat!");
            window.location.href = "index.html";
        }

        loadDetails();

        async function loadDetails() {
            try {
                const res = await fetch(`${API}/furnizari/${furnizareId}`);
                if(!res.ok) throw new Error("Produsul nu a fost gƒÉsit!");
                
                currentOffer = await res.json();
                
                document.getElementById('d_nume').innerText = currentOffer.produs.denumire;
                document.getElementById('d_prod').innerText = currentOffer.producator.denumire;
                document.getElementById('d_tara').innerText = currentOffer.producator.taraOrigine;
                
                // --- MODIFICAT AICI: Afisam Data Producere ---
                // Am schimbat ID-ul din HTML in 'd_data_prod' si variabila in 'dataProducere'
                document.getElementById('d_data_prod').innerText = currentOffer.produs.dataProducere;
                
                document.getElementById('d_pret').innerHTML = currentOffer.pretAchizitie + ' <small>RON</small>';
                
                // LOGICA STOC
                const stocElement = document.getElementById('d_stoc');
                const badge = document.getElementById('stockBadge');
                const btn = document.getElementById('btnAdauga');
                const inputCantitate = document.getElementById('cantitate');
                
                const stocCurent = currentOffer.stoc !== undefined ? currentOffer.stoc : 0;
                stocElement.innerText = stocCurent;

                if (stocCurent <= 0) {
                    stocElement.innerText = "EPUIZAT";
                    badge.classList.add('out'); 
                    
                    btn.disabled = true;
                    btn.innerText = "Indisponibil";
                    inputCantitate.disabled = true;
                    inputCantitate.value = 0;
                } else {
                    inputCantitate.setAttribute("max", stocCurent);
                }

                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'flex'; 

            } catch (e) { 
                document.getElementById('loading').innerText = "Eroare: " + e.message; 
            }
        }

        function adaugaInCos() {
            const cantitateCeruta = parseInt(document.getElementById('cantitate').value);
            const stocDisponibil = currentOffer.stoc !== undefined ? currentOffer.stoc : 0;

            if (isNaN(cantitateCeruta) || cantitateCeruta <= 0) {
                alert("Cantitatea trebuie sƒÉ fie minim 1.");
                return;
            }

            const cartKey = 'shoppingCart_' + clientId;
            let cos = JSON.parse(localStorage.getItem(cartKey)) || [];
            const indexExistent = cos.findIndex(item => item.furnizareId === currentOffer.id);

            if (indexExistent !== -1) {
                const cantitateInCos = cos[indexExistent].cantitate;
                if (cantitateInCos + cantitateCeruta > stocDisponibil) {
                    alert(`Stoc insuficient! Ai deja ${cantitateInCos} buc √Æn co»ô.`);
                    return;
                }
                cos[indexExistent].cantitate += cantitateCeruta;
                alert("Co»ô actualizat!");
            } else {
                if (cantitateCeruta > stocDisponibil) {
                    alert(`Stoc insuficient! Maxim ${stocDisponibil} buc.`);
                    document.getElementById('cantitate').value = stocDisponibil;
                    return;
                }
                cos.push({
                    furnizareId: currentOffer.id,
                    produsId: currentOffer.produs.id,
                    nume: currentOffer.produs.denumire,
                    producator: currentOffer.producator.denumire,
                    pret: currentOffer.pretAchizitie,
                    cantitate: cantitateCeruta,
                    stocMax: stocDisponibil 
                });
                alert("AdƒÉugat √Æn co»ô!");
            }

            localStorage.setItem(cartKey, JSON.stringify(cos));
            window.location.href = "dashboard_client.html";
        }
    </script>
</body>
</html>